<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-CA">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Action Potential Analysis • patchclampplotteR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Action Potential Analysis">
<meta name="description" content="Learn how to obtain action potential properties from a raw .abf file in Clampfit.
">
<meta property="og:description" content="Learn how to obtain action potential properties from a raw .abf file in Clampfit.
">
<meta property="og:image" content="https://christelinda-laureijs.github.io/patchclampplotteR/logo.png">
<!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-M92L6F0ZB2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-M92L6F0ZB2');
</script><link rel="icon" type="image/x-icon" href="favicon.ico">
<link rel="icon" type="image/x-icon" href="../favicon.ico">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">patchclampplotteR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/patchclampplotteR.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/evoked-current-analysis.html">Evoked Current Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/action-potential-analysis.html">Action Potential Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/spontaneous-current-analysis.html">Spontaneous Current Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/FAQ.html">FAQ</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/christelinda-laureijs/patchclampplotteR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="action-potential-analysis_files/core-js-2.5.3/shim.min.js"></script><script src="action-potential-analysis_files/react-18.2.0/react.min.js"></script><script src="action-potential-analysis_files/react-18.2.0/react-dom.min.js"></script><script src="action-potential-analysis_files/reactwidget-2.0.0/react-tools.js"></script><link href="action-potential-analysis_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="action-potential-analysis_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="action-potential-analysis_files/reactable-0.4.4/reactable.css" rel="stylesheet">
<script src="action-potential-analysis_files/reactable-binding-0.4.4/reactable.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Action Potential Analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/christelinda-laureijs/patchclampplotteR/blob/main/vignettes/articles/action-potential-analysis.Rmd" class="external-link"><code>vignettes/articles/action-potential-analysis.Rmd</code></a></small>
      <div class="d-none name"><code>action-potential-analysis.Rmd</code></div>
    </div>

    
    
<p>This vignette will demonstrate how to analyze action potential
properties using a raw .abf file. You will identify the first current
injection that resulted in action potentials and then select the first
action potential within this sweep for further analyses.</p>
<div class="figure" style="text-align: center">
<img src="figures/AP-first-trace.png" alt="An image of a current clamp steps recording with the first action potential outlined with a box." width="75%"><p class="caption">
The box outlines the first action potential on the first sweep with
action potentials.
</p>
</div>
<blockquote>
<p>You will identify the threshold using the first derivative method.
This means that the threshold corresponds to the membrane potential
where the action potential velocity is 10 mV/ms or greater (Farries et
al., 2010).</p>
</blockquote>
<div class="section level3">
<h3 id="set-up-data-sheet">Set up data sheet<a class="anchor" aria-label="anchor" href="#set-up-data-sheet"></a>
</h3>
<p>Before you begin, you should set up a .csv file. I would suggest
using a consistent naming scheme that includes the date. I use the
<code>YYYYMMDD-title.csv</code> format, such as
<code>20250113-AP-analysis.csv</code>. This makes it easy to identify
when I last analyzed my data, and the files sort easily.</p>
<p>In your .csv file, fill row 1 with the following column titles.
Notice that all (except for <code>ID</code> are in lowercase.</p>
<ul>
<li>
<code>letter</code> The unique letter identifier of a single cell.
You can use this to link data from different recordings taken from the
same cell.</li>
<li>
<code>state</code> A character value. In this example, the values
are <code>Baseline</code> and <code>Insulin</code>, indicating a current
clamp protocol taken after the cell had been exposed to 500 nM insulin
for 25 minutes.</li>
<li>
<code>time_of_threshold</code> A numerical value (in ms) used to
determine properties like the latency to fire.</li>
<li>
<code>t_x</code> The membrane potential at the moment that an action
potential is initiated, also known as the threshold.</li>
<li>
<code>t11</code> The derivative of the trace you are analyzing. Must
be 10 mV/ms or greater to properly identify the threshold.</li>
<li>
<code>ID</code> A character value indicating the recording number.
This corresponds to the <code>File Name</code> column that is
automatically generated in the Results sheet in Clampfit.</li>
<li>
<code>first_sweep_with_APs</code> A number representing the earliest
sweep number where action potentials first appeared.</li>
<li>
<code>trace_start</code> This is an automatic value calculated by
Clampfit, and it corresponds to the sweep number. It is not used in any
analyses, but it will automatically be included in the Results sheet in
Clampfit. It’s faster to just copy all the data rather than try to
exclude this value.</li>
<li>
<code>peak_amplitude</code> The membrane potential (in mV) during
maximum depolarization.</li>
<li>
<code>time_to_peak</code> The time of the peak amplitude (in ms),
which should also be relative to the <code>time_of_threshold</code> if
you have repositioned Cursor 1 to the
<code>time_of_threshold</code>.</li>
<li>
<code>antipeak_amplitude</code> The afterhyperpolarization amplitude
(in mV)</li>
<li>
<code>time_of_antipeak</code> The time of the
after-hyperpolarization (in ms), which should be relative to the
<code>time_of_threshold</code>.</li>
<li>
<code>half_width</code> The width of the action potential when the
membrane potential is half of the <code>peak_amplitude</code>.</li>
<li>
<code>ap_notes</code> An optional column where you can note any
unusual or interesting things about the recording, or flag a
nice-looking recording for use in a paper.</li>
</ul>
<a href="data:text/csv;base64,bGV0dGVyLHN0YXRlLHRpbWVfb2ZfdGhyZXNob2xkLHRfeCx0MTEsSUQsZmlyc3Rfc3dlZXBfd2l0aF9BUHMsdHJhY2Vfc3RhcnQscGVha19hbXBsaXR1ZGUsdGltZV90b19wZWFrLGFudGlwZWFrX2FtcGxpdHVkZSx0aW1lX29mX2FudGlwZWFrLGhhbGZfd2lkdGgsYXBfbm90ZXMK" download="sample-blank-ap-parameter-data.csv">Download sample-blank-ap-parameter-data.csv</a>
<p><img src="figures/AP-properties.png" alt="An image of an action potential with labels indicating properties such as the peak amplitude, half-width, after-hyperpolarization, and latency to fire." width="75%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="get-derivative">Get derivative<a class="anchor" aria-label="anchor" href="#get-derivative"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Open the .abf file containing the current clamp step protocol in
Clampfit. Ensure that the x-axis shows time in milliseconds. If it shows
seconds, double-click the x-axis, and change the
<code>Elapsed Time</code> from <code>Automatic</code> to
<code>Milliseconds</code>.</li>
</ol>
<blockquote>
<p><strong>Warning!</strong> The y-axis values should generally be
around -70 mV during the flat regions outside of the current injection.
Sometimes the scaling factor in Clampfit is distorted (for unknown
reasons) and the y-axis may be in the thousands range. If this happens,
follow step 1b).</p>
</blockquote>
<p>1b. If the y-axis scale is off (see the warning box above),
double-click on the y-axis to open the
<code>Modify Signal Parameters</code> box. Change the <code>V/pA</code>
ratio to 0.01, and click “OK”. This will re-scale the y-axis to the
correct units relative to the current injections. Double-check that the
x-axis is in milliseconds!</p>
<div class="figure" style="text-align: center">
<img src="figures/Fix-y-scale.png" alt="A screenshot of a dialog box in Clampfit with an option to change the V/pA ratio to 0.01." width="75%"><p class="caption">
Sometimes the V/pA ratio is altered, so you may need to change it to
0.01.
</p>
</div>
<p>1c. Click on the <code>Show Aquistion Signals</code> button and then
<code>Previous Signal</code> (blue arrow in the figure below) to view
the sweeps showing changes in current (<code>Vm_primary</code>). The
traces should all be stacked on top of each other, but if they are not,
click on <code>View</code> -&gt; <code>Data Display</code> -&gt;
<code>Sweeps</code>.</p>
<p>1d. You can also click on the <code>Auto Scale All Y Axes</code>
button (orange arrow) to help you see the data faster.</p>
<p><img src="figures/Viewer-buttons.png" alt="A screenshot of the Show Signals buttons and other viewing buttons available in the upper toolbar in Clampfit." width="25%" style="display: block; margin: auto;"></p>
<ol start="2" style="list-style-type: decimal">
<li><p>Press the “Enter” key to show just one sweep at a time. It will
begin at the sweep corresponding to the lowest current injection. Use
greater than symbol (<code>&gt;</code>) to cycle up through the
sweeps.</p></li>
<li><p>Move up to sweeps corresponding to higher current injections
until you identify the first sweep that contains an action potential. I
will call this <code>t_x</code>, since it may be <code>t5</code> in one
recording, or <code>t6</code> in another, etc.</p></li>
<li><p>Position Cursors 1 and 2 around the first action potential in
<code>t_x</code>. Cursor 1 should be before the threshold (aim for the
area before the slope of the curve increases steeply). Cursor 2 should
be in the after-hyperpolarization region.</p></li>
</ol>
<div class="figure" style="text-align: center">
<img src="figures/AP-cursor-1-placement.png" alt="A screenshot of an action potential with a green dot indicating the position of cursor 1. Cursor 1 should be at the middle portion of the curve, not the beginning of the curve (too early) or near the peak (too late)." width="75%"><p class="caption">
The ideal placement of Cursor 1 should be in the middle of the curve.
Left: Cursor 1 is placed where the curve is very steep, and it is likely
that you will miss the threshold. Middle: Cursor 1 is very low, so
Clampfit may identify this as the after-hyperpolarization. Right: This
is the ideal spot, where the cursor is early enough to capture the
threshold in the search region.
</p>
</div>
<blockquote>
<p><strong>Warning!</strong> It is important that Cursor 2 touches the
curve at a value that is lower than the voltage value for Cursor 1. If
Cursor 1 is lower, then Clampfit may identify the location at Cursor 1
as the after-hyperpolarization region if you forget to move the cursor
to the threshold (see step 11).</p>
</blockquote>
<p><img src="figures/AP-cursors.png" alt="A screenshot of Clampfit showing cursors positioned around the first action potential. The first cursor is located at a point with a y-axis value that is greater than Cursor 2." width="75%" style="display: block; margin: auto;"></p>
<ol start="5" style="list-style-type: decimal">
<li><p>Click on the arithmetic button (it is the button with basic math
symbols), then Add Traces. Write “1” and click OK. This will add a new
empty trace, called <code>t11</code>.</p></li>
<li><p><code>t11</code> should be the derivative of <code>t_x</code>. In
the <code>Expression</code> box, write <code>t11=diff(t6)</code>
(replace <code>t6</code> with your value for <code>t_x</code>).</p></li>
</ol>
<p><img src="figures/AP-expression-box.png" alt="A screenshot of the Arithmetic box of Clampfit showing the formula t11=diff(t6) inserted into the expression field." width="75%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="find-threshold">Find threshold<a class="anchor" aria-label="anchor" href="#find-threshold"></a>
</h3>
<ol start="7" style="list-style-type: decimal">
<li><p>Click on <code>Edit</code> -&gt; <code>Transfer Traces</code> and
set the <code>Region to transfer</code> as <code>Cursors 1..2</code>. In
the <code>Trace Selection</code> category, choose only
<code>Vm_primary ()</code> as the signal. Select <code>t_x</code> and
<code>t11</code> for the traces, then click OK.</p></li>
<li><p>Click on the Results sheet (<code>Window</code> -&gt;
<code>Results1</code>). The <code>Results</code> page will display three
columns: <code>Time (ms)</code>,
<code>Trace #6 (or #5, #7, etc.)</code>, and <code>Trace #11</code>.
<code>Trace #x</code> is the membrane potential in mV, and
<code>Trace #11</code> is the derivative of
<code>Trace #x</code>.</p></li>
</ol>
<blockquote>
<p><strong>Warning!</strong> The Results page of the transferred traces
does not delete data between files. If you are doing several analyses in
one session, ensure that you are looking at the correct columns
corresponding to the active recording.</p>
</blockquote>
<blockquote>
<p><strong>Note</strong> If you recently opened a results file in
Clampfit, it will automatically overwrite the contents of Sheet 14, and
you will not see the transferred traces. If you don’t see any results,
you may need to close and re-open Clampfit.</p>
</blockquote>
<ol start="9" style="list-style-type: decimal">
<li>Scroll down the <code>Trace #11</code> column (the derivative
column) until you see a series of positive values with increasing
magnitude (e.g. &gt; 100 or more). This is where the derivative is
increasing. Select the first value within this series that is greater
than or equal to 10 mV/ms. Copy the value of all three columns in this
row.</li>
</ol>
<blockquote>
<p><em>Note</em> There may be isolated peaks within the derivative that
are greater than 10 mV/ms. Only select this value if it is part of a
series of increasingly larger positive values, followed by a series of
negative values.</p>
</blockquote>
<ol start="10" style="list-style-type: decimal">
<li>If the scaling is correct, the threshold (<code>t_x</code>) should
be around -30 mV for a healthy cell. Your .csv file should now look like
this:</li>
</ol>
<div class="reactable html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"letter":["BN"],"state":["Baseline"],"time_of_threshold":[373.5],"t_x":[-32.1],"t11":[10.38]},"columns":[{"id":"letter","name":"letter","type":"character"},{"id":"state","name":"state","type":"character"},{"id":"time_of_threshold","name":"time_of_threshold","type":"numeric"},{"id":"t_x","name":"t_x","type":"numeric"},{"id":"t11","name":"t11","type":"numeric"}],"dataKey":"751cef46bb0483f9558bac326d7bb488"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level3">
<h3 id="measure">Measure action potential properties<a class="anchor" aria-label="anchor" href="#measure"></a>
</h3>
<ol start="11" style="list-style-type: decimal">
<li>Double-click on Cursor 1 and change its x-position value
(<code>time</code>) to match the <code>time_of_threshold</code>.</li>
</ol>
<div class="figure" style="text-align: center">
<img src="figures/AP-cursors-new.png" alt="A screenshot of Clampfit showing cursors positioned around the first action potential. The first cursor is now located at the x-value where the membrane potential is equal to the threshold." width="75%"><p class="caption">
Note how Cursor 1 is shifted to the right relative to the earlier cursor
image. It is now located at the x-value where the membrane potential
crosses the threshold.
</p>
</div>
<blockquote>
<p><strong>Warning!</strong> If you do not reposition Cursor 1 to be at
the time of threshold, the values for <code>time_of_peak</code> and
<code>time_of_antipeak</code> will be incorrect!</p>
</blockquote>
<ol start="12" style="list-style-type: decimal">
<li><p>Click on the Statistics button (a small icon with a summation
symbol on top of it) or press <code>Alt+s</code>.</p></li>
<li><p>Set the following settings:</p></li>
</ol>
<ul>
<li>Trace Selection: Choose <code>Vm_primary ()</code>. <code>t_x</code>
and <code>t11</code> will automatically be selected.</li>
<li>Peak Polarity: <code>Vm_primary</code>,
<code>Positive-going</code>
</li>
<li>Baseline Region: Fixed at
<code>[paste in the threshold value (column t_x in your sheet) here]</code>
</li>
<li>Search Region 1: Range: <code>Cursors 1..2</code>
</li>
<li>Destination Option: <code>Replace results in sheet</code> (prevents
you from accidentally copying old data</li>
<li>Column Order: <code>Measurement, Region, Signal</code>
</li>
<li>Measurements: <code>peak_amplitude</code>,
<code>time of peak</code>, <code>antipeak amplitude</code>,
<code>time of antipeak</code>, <code>half-width</code>
</li>
</ul>
<p>Click OK and then <code>Window</code> -&gt; <code>Results1</code> to
see the Results page.</p>
<p><img src="figures/AP-statistics-box.png" alt="A screenshot of the Statistics box of Clampfit showing the correct options to select." width="75%" style="display: block; margin: auto;"></p>
<ol start="14" style="list-style-type: decimal">
<li><p>Go to the row corresponding to Trace <code>t_x</code>. Select all
data except for the <code>File Path</code> column (unless you think you
will need it later) and paste it into the .csv file. You’ll notice that
the .csv column names are different than the column names in the
<code>Results</code> sheet. I changed these column names to make them
easier to use in R code.</p></li>
<li><p>Your .csv file should now look like this.</p></li>
</ol>
<div class="reactable html-widget html-fill-item" id="htmlwidget-e5c8c404fe174e4c81bd" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e5c8c404fe174e4c81bd">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"letter":["BN"],"state":["Baseline"],"time_of_threshold":[373.5],"t_x":[-32.1],"t11":[10.38],"ID":["23711003.abf"],"first_sweep_with_APs":[6],"trace_start":[5021],"peak_amplitude":[72.54],"time_to_peak":[0.7],"antipeak_amplitude":[-17.73],"time_of_antipeak":[4.4],"half_width":[1.09]},"columns":[{"id":"letter","name":"letter","type":"character"},{"id":"state","name":"state","type":"character"},{"id":"time_of_threshold","name":"time_of_threshold","type":"numeric"},{"id":"t_x","name":"t_x","type":"numeric"},{"id":"t11","name":"t11","type":"numeric"},{"id":"ID","name":"ID","type":"character"},{"id":"first_sweep_with_APs","name":"first_sweep_with_APs","type":"numeric"},{"id":"trace_start","name":"trace_start","type":"numeric"},{"id":"peak_amplitude","name":"peak_amplitude","type":"numeric"},{"id":"time_to_peak","name":"time_to_peak","type":"numeric"},{"id":"antipeak_amplitude","name":"antipeak_amplitude","type":"numeric"},{"id":"time_of_antipeak","name":"time_of_antipeak","type":"numeric"},{"id":"half_width","name":"half_width","type":"numeric"}],"dataKey":"12e9d60e1759c119e1cbdd973e7944a8"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script><ol start="16" style="list-style-type: decimal">
<li><p>While you still have this file open, you may want to count action
potentials (see the section on <a href="#count">counting action
potentials</a> below). Or, you could wait and do these separately, which
you might find more efficient.</p></li>
<li><p>A completed dataset should look something like the spreadsheet
below.</p></li>
</ol>
<blockquote>
<p><em>Note</em> If there are no action potentials in the later
recording, insert the values for the columns <code>letter</code> and
<code>state</code> and leave all the others blank.</p>
</blockquote>
<div class="reactable html-widget html-fill-item" id="htmlwidget-36aa3d2a04d42bbc2145" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-36aa3d2a04d42bbc2145">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"letter":["BO","BO","BP","BP","BT","BT"],"state":["Baseline","Insulin","Baseline","","Baseline","Insulin"],"time_of_threshold":[329.6,358.6,468.3,"NA",407.1,518.3],"t_x":[-29.63,-35.49,-33.81,"NA",-28.35,-33.26],"t_11":[67.13,26.24,10.68,"NA",28.99,17.69],"ID":["23714007.abf","23714015.abf","23714026.abf","","23719005.abf","23719018.abf"],"first_sweep_with_APs":[6,7,5,"NA",8,8],"trace_start":[5021,6021,4021,"NA",7021,7021],"peak_amplitude":[77.67,84.35,70.19,"NA",77.67,70.1],"time_to_peak":[330.1,359.1,468.9,"NA",407.6,518.9],"antipeak_amplitude":[-17.3,-16.48,-15.62,"NA",-7.11,-25.39],"time_of_antipeak":[332.6,361.5,471.2,"NA",410.5,521.9],"half_width":[0.79,0.77,0.89,"NA",0.96,0.78]},"columns":[{"id":"letter","name":"letter","type":"character"},{"id":"state","name":"state","type":"character"},{"id":"time_of_threshold","name":"time_of_threshold","type":"numeric"},{"id":"t_x","name":"t_x","type":"numeric"},{"id":"t_11","name":"t_11","type":"numeric"},{"id":"ID","name":"ID","type":"character"},{"id":"first_sweep_with_APs","name":"first_sweep_with_APs","type":"numeric"},{"id":"trace_start","name":"trace_start","type":"numeric"},{"id":"peak_amplitude","name":"peak_amplitude","type":"numeric"},{"id":"time_to_peak","name":"time_to_peak","type":"numeric"},{"id":"antipeak_amplitude","name":"antipeak_amplitude","type":"numeric"},{"id":"time_of_antipeak","name":"time_of_antipeak","type":"numeric"},{"id":"half_width","name":"half_width","type":"numeric"}],"dataKey":"80cf50123c415855429aaee09267eb37"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script><ol start="18" style="list-style-type: decimal">
<li><p>You are now ready to import your data into R! Use the
<code><a href="../reference/add_new_cells.html">add_new_cells()</a></code> function with
<code>data_type = "AP_parameter"</code>. You may find it helpful to read
the <a href="https://christelinda-laureijs.github.io/patchclampplotteR/articles/patchclampplotteR.html">Get
Started</a> guide if you are setting up your data for the first
time.</p></li>
<li><p>Use the <code><a href="../reference/plot_AP_comparison.html">plot_AP_comparison()</a></code> function to see how
parameters like <code>peak_amplitude</code> and <code>half-width</code>
change after your treatment.</p></li>
</ol>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_AP_comparison.html">plot_AP_comparison</a></span><span class="op">(</span></span>
<span>  <span class="va">sample_AP_data</span>,</span>
<span>  plot_treatment <span class="op">=</span> <span class="st">"Control"</span>,</span>
<span>  plot_category <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  y_variable <span class="op">=</span> <span class="st">"peak_amplitude"</span>,</span>
<span>  y_axis_title <span class="op">=</span> <span class="st">"Peak Amplitude (pA)"</span>,</span>
<span>  theme_options <span class="op">=</span> <span class="va">sample_theme_options</span>,</span>
<span>  baseline_label <span class="op">=</span> <span class="st">"Baseline"</span>,</span>
<span>  test_type <span class="op">=</span> <span class="st">"wilcox.test"</span>,</span>
<span>  post_hormone_label <span class="op">=</span> <span class="st">"Insulin"</span>,</span>
<span>  treatment_colour_theme <span class="op">=</span> <span class="va">sample_treatment_names_and_colours</span>,</span>
<span>  save_plot_png <span class="op">=</span> <span class="st">"no"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="action-potential-analysis_files/figure-html/ap-comparison-1.png" alt="A plot of peak amplitude in pico amps versus state (baseline or insulin). The data are coloured according to state, where baseline points are gray and insulin points are purple. Insulin decreased action potential amplitude." width="75%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="count">Count action potentials<a class="anchor" aria-label="anchor" href="#count"></a>
</h3>
<p>The next step is to count the number of action potentials in each
sweep. This will allow you to later make a plot of action potential
frequency vs. current injection and see how a treatment affect action
potential frequency.</p>
<ol start="18" style="list-style-type: decimal">
<li>Create a separate .csv file (for example
<code>20250113-AP-count-data.csv</code>). This file should have four
columns:</li>
</ol>
<ul>
<li>
<code>letter</code> The unique letter identifier of a single
cell.</li>
<li>
<code>state</code> A character value (“Baseline” or “Insulin” in
this example)</li>
<li>
<code>sweep</code> A number from 1 to 10 (see step 18a to generate
this)</li>
<li>
<code>no_of_APs</code> a numerical value indicating the number of
action potentials</li>
</ul>
<p>18a. To generate a repeated sequence from 1-10 quickly, type the
number 1 in cell <code>C2</code>. Then, type the number 2 in cell
<code>C3</code>.</p>
<p>18b. Select <code>C2</code> and <code>C3</code> together, then hover
your mouse over the bottom right corner of the group until you see a
small black plus symbol.</p>
<p><img src="figures/Excel-plus.png" alt="A screenshot of Excel with two cells selected. A plus symbol is present on the bottom right corner of the selection." width="25%" style="display: block; margin: auto;"></p>
<p>18c. Click and hold down the mouse key and drag the selection down to
<code>C11</code> to generate a sequence from 1 to 10.</p>
<p>18d. The entire range from <code>C2</code> to <code>C11</code> should
be selected. Move your mouse to the bottom right corner of the cell
until you see the <code>+</code> symbol again. Hold down the
<code>Ctrl</code> key and drag this selection down. This will generate
the sequence from 1-10 repeatedly (e.g. 1, 2, 3, 4, 5, 6, 7, 8, 9, 10,
1, 2, 3…)</p>
<p>18e. You can then copy and paste this range repeatedly to fill your
column.</p>
<ol start="19" style="list-style-type: decimal">
<li>Open a current clamp steps recording in Clampfit (you may be coming
directly from step 16 when you <a href="#measure">measured action
potential properties</a>).</li>
</ol>
<p>19b. <em>Ignore these instructions if you’ve already set up the plot
view</em> You may need to zoom in to see it better. Click on the
<code>Show Aquistion Signals</code> button and then
<code>Previous Signal</code> (blue arrow in the figure below) to view
the sweeps showing changes in current (<code>Im_primary ()</code>). The
traces should all be stacked on top of each other, but if they are not,
click on <code>View</code> -&gt; <code>Data Display</code> -&gt;
<code>Sweeps</code>. You can also click on the
<code>Auto Scale All Y Axes</code> button (orange arrow) to help you see
the data faster.</p>
<p><img src="figures/Viewer-buttons.png" alt="A screenshot of the Show Signals buttons and other viewing buttons available in the upper toolbar in Clampfit." width="25%" style="display: block; margin: auto;"></p>
<ol start="20" style="list-style-type: decimal">
<li>Press the <code>Enter</code> key to view one sweep at a time, and
use <code>&lt;</code> and <code>&gt;</code> to cycle through the sweeps.
Count the number of action potentials in each sweep, and record them in
the <code>no_of_APs</code> column.</li>
</ol>
<blockquote>
<p>Yes, this step may seem super simple, but that’s because it is - look
at each sweep and count the number of action potentials present!</p>
</blockquote>
<p>20b. <em>Tip!</em> If there are no action potentials in a sweep,
leave the cell in your Excel sheet blank. After you have finished
collecting data from many cells, you can automatically fill blank cells
with <code>0</code>.</p>
<p>20c. Select the <code>no_of_APs</code> column. Then, click on
<code>Home</code> -&gt; <code>Editing</code> -&gt;
<code>Find and Select</code> -&gt; <code>Go to Special</code> and then
choose <code>Blanks</code>.</p>
<p>20d. All of the blank cells should be selected. Type the number
<code>0</code>, and then press <code>Ctrl + Enter</code> or
<code>Cmd + Enter</code> on a Mac. All blank values should be filled
with 0s now.</p>
<ol start="21" style="list-style-type: decimal">
<li>Here is an example of what one recording could look like:</li>
</ol>
<div class="reactable html-widget html-fill-item" id="htmlwidget-febe03efa1a2d8d52a86" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-febe03efa1a2d8d52a86">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"letter":["BO","BO","BO","BO","BO","BO","BO","BO","BO","BO","BO","BO","BO","BO","BO","BO","BO","BO","BO","BO"],"state":["Baseline","Baseline","Baseline","Baseline","Baseline","Baseline","Baseline","Baseline","Baseline","Baseline","Insulin","Insulin","Insulin","Insulin","Insulin","Insulin","Insulin","Insulin","Insulin","Insulin"],"sweep":[1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10],"no_of_APs":[0,0,0,0,0,9,5,7,7,6,0,0,0,0,0,0,3,4,4,4]},"columns":[{"id":"letter","name":"letter","type":"character"},{"id":"state","name":"state","type":"character"},{"id":"sweep","name":"sweep","type":"numeric"},{"id":"no_of_APs","name":"no_of_APs","type":"numeric"}],"dataKey":"5a1bf41e5204ed470a676f4cc7bf0232"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script><ol start="22" style="list-style-type: decimal">
<li><p>You are now ready to import the data into R! Use
<code><a href="../reference/add_new_cells.html">add_new_cells()</a></code> with
<code>data_type == "AP_count"</code>.</p></li>
<li><p>Here is an example of the type of plots you can create!</p></li>
</ol>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_AP_frequencies_single_treatment.html">plot_AP_frequencies_single_treatment</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">sample_AP_count_data</span>,</span>
<span>  plot_treatment <span class="op">=</span> <span class="st">"Control"</span>,</span>
<span>  plot_category <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  baseline_label <span class="op">=</span> <span class="st">"Baseline"</span>,</span>
<span>  hormone_added <span class="op">=</span> <span class="st">"Insulin"</span>,</span>
<span>  significance_display_method <span class="op">=</span> <span class="st">"stars"</span>,</span>
<span>  treatment_colour_theme <span class="op">=</span> <span class="va">sample_treatment_names_and_colours</span>,</span>
<span>  large_axis_text <span class="op">=</span> <span class="st">"no"</span>,</span>
<span>  test_type <span class="op">=</span> <span class="st">"wilcox.test"</span>,</span>
<span>  theme_options <span class="op">=</span> <span class="va">sample_theme_options</span>,</span>
<span>  save_plot_png <span class="op">=</span> <span class="st">"no"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="action-potential-analysis_files/figure-html/ap-frequencies-one-treatment-1.png" alt="A plot of Action Potential Frequency in Hz versus current injection on the x-axis. The data are coloured gray for baseline data and purple for insulin data. The plot is showing that action potential frequency was lower after adding insulin." width="75%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_AP_frequencies_multiple_treatments.html">plot_AP_frequencies_multiple_treatments</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">sample_AP_count_data</span>,</span>
<span>  include_all_treatments <span class="op">=</span> <span class="st">"yes"</span>,</span>
<span>  plot_category <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  treatment_colour_theme <span class="op">=</span> <span class="va">sample_treatment_names_and_colours</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="action-potential-analysis_files/figure-html/ap-plot-frequencies-multiple-treatments-1.png" alt="A smoothed line plot showing action potential frequency in Hz versus current injection in picoamps for four different treatments at two states (baseline vs. insulin). Overall, insulin decreased action potential frequency in all treatments." width="75%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="plotting-sweeps">Plotting Sweeps<a class="anchor" aria-label="anchor" href="#plotting-sweeps"></a>
</h2>
<p>You can plot action potential recordings using
<code>plot_AP_traces()</code>. Use a dataframe generated using
<code><a href="../reference/import_ABF_file.html">import_ABF_file()</a></code> with
<code>recording_mode = "current_clamp"</code>. You can then plot all
sweeps using
<code>sweeps = as.character(unique(sample_ap_abf_baseline$episode))</code>.
Just replace <code>sample_ap_abf_baseline</code> with the dataframe that
you inserted into the <code>data</code> argument. Set
<code>colour_scale_option</code> to one of three options: “viridis”,
“custom” or “single_colour”.</p>
<div class="section level3">
<h3 id="viridis">Viridis<a class="anchor" aria-label="anchor" href="#viridis"></a>
</h3>
<p>“viridis” enables the beautiful colourblind-friendly viridis palettes
from the <code>viridis</code> package. Look at the <a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">documentation
for <code>scale_color_viridis</code></a> to learn about options you can
use. These include <code>begin</code>, <code>option</code>,
<code>theme</code> and more.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_AP_trace.html">plot_AP_trace</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">sample_ap_abf_baseline</span>,</span>
<span>  sweeps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">sample_ap_abf_baseline</span><span class="op">$</span><span class="va">episode</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  colour_scale_option <span class="op">=</span> <span class="st">"viridis"</span>,</span>
<span>  plot_category <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  plot_treatment <span class="op">=</span> <span class="st">"Control"</span>,</span>
<span>  direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>  option <span class="op">=</span> <span class="st">"plasma"</span>,</span>
<span>  begin <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  end <span class="op">=</span> <span class="fl">0.8</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="action-potential-analysis_files/figure-html/ap-trace-viridis-1.png" alt="A plot of current clamp steps where each sweep is coloured a different colour. The colour scheme is part of the plasma theme from the viridis package." width="75%" style="display: block; margin: auto;"></p>
<p>This is how you would plot selected sweeps. Include a list of one or
more values corresponding to the sweep names (“epi1” to “epi10” in this
example).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_AP_trace.html">plot_AP_trace</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">sample_ap_abf_baseline</span>,</span>
<span>  sweeps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"epi1"</span>, <span class="st">"epi5"</span>, <span class="st">"epi10"</span><span class="op">)</span>,</span>
<span>  colour_scale_option <span class="op">=</span> <span class="st">"viridis"</span>,</span>
<span>  plot_category <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  plot_treatment <span class="op">=</span> <span class="st">"Control"</span>,</span>
<span>  direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>  option <span class="op">=</span> <span class="st">"plasma"</span>,</span>
<span>  begin <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  end <span class="op">=</span> <span class="fl">0.8</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="action-potential-analysis_files/figure-html/ap-trace-viridis-three-sweeps-1.png" alt="A plot of current clamp steps showing three sweeps only." width="75%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="custom-scale">Custom scale<a class="anchor" aria-label="anchor" href="#custom-scale"></a>
</h3>
<p>If you use <code>colour_scale_option = "custom"</code> you must
define a list of character values (can be hex values or named colours)
in the <code>custom_scale_colours</code> argument.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_AP_trace.html">plot_AP_trace</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">sample_ap_abf_baseline</span>,</span>
<span>  sweeps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">sample_ap_abf_baseline</span><span class="op">$</span><span class="va">episode</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  custom_scale_colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#edd03a"</span>, <span class="st">"#cced34"</span>, <span class="st">"#a3fd3d"</span>, <span class="st">"#6bfe64"</span>, <span class="st">"#31f199"</span>, <span class="st">"#18dcc3"</span>, <span class="st">"#29bbec"</span>, <span class="st">"#4294ff"</span>, <span class="st">"#466be3"</span>, <span class="st">"#4040a2"</span><span class="op">)</span>,</span>
<span>  colour_scale_option <span class="op">=</span> <span class="st">"custom"</span>,</span>
<span>  plot_category <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  plot_treatment <span class="op">=</span> <span class="st">"Control"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="action-potential-analysis_files/figure-html/unnamed-chunk-2-1.png" alt="A series of action potential sweeps where each sweep is a different colour. The colour scheme is part of the turbo rainbow scheme from yellow to blue." width="75%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="single-colour">Single colour<a class="anchor" aria-label="anchor" href="#single-colour"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_AP_trace.html">plot_AP_trace</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">sample_ap_abf_baseline</span>,</span>
<span>  sweeps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">sample_ap_abf_baseline</span><span class="op">$</span><span class="va">episode</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  trace_colour <span class="op">=</span> <span class="st">"#6600cc"</span>,</span>
<span>  colour_scale_option <span class="op">=</span> <span class="st">"single_colour"</span>,</span>
<span>  plot_category <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  plot_treatment <span class="op">=</span> <span class="st">"Control"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="action-potential-analysis_files/figure-html/unnamed-chunk-3-1.png" alt="A series of action potential sweeps that are all coloured purple." width="75%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="faq">FAQ<a class="anchor" aria-label="anchor" href="#faq"></a>
</h3>
<p><em>What do I do if there are no action potentials following
treatment?</em></p>
<p>Do not discard this cell; this is important and meaningful data! Fill
in only the letter and state, and leave all other columns blank. R will
fill this with NA values, since there are no action potential properties
to measure. However, for your AP count data, please just indicate
<code>0</code> for all current injections.</p>
<p><em>What do I do if there are action potentials outside of the time
when a current injection was applied?</em></p>
<p><img src="figures/APs-outside-sweep.png" alt="A screenshot of a recording in Clampfit showing action potentials present outside of the range where a current injection was applied." width="75%" style="display: block; margin: auto;"></p>
<p>This can happen with very excitable cells. Only count the action
potentials that occurred within the injection period.</p>
<p><em>Should I count an action potential that looks very wavy?</em></p>
<p><img src="figures/Wavy-APs-check.png" alt="A screenshot of a recording in Clampfit showing wavy action potentials. Valid action potentials are indicated with check marks" width="75%" style="display: block; margin: auto;"></p>
<p>Only include the action potential if it clearly crosses the
threshold, comes to a sharp peak, and has an after-hyperpolarization
period.</p>
<p>References</p>
<p>Farries, M. A., Kita, H., &amp; Wilson, C. J. (2010). Dynamic Spike
Threshold and Zero Membrane Slope Conductance Shape the Response of
Subthalamic Neurons to Cortical Input. Journal of Neuroscience, 30(39),
13180–13191. <a href="https://doi.org/10.1523/JNEUROSCI.1909-10.2010" class="external-link uri">https://doi.org/10.1523/JNEUROSCI.1909-10.2010</a></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://christelindalaureijs.com" class="external-link">Christelinda Laureijs</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
